version: "{build}"
configuration: Release
image: Visual Studio 2017
install:
  - ps: choco install gitversion.portable -pre -y -r --no-progress
  # Download .NET Core preview SDK and add to PATH to work around
  # https://github.com/NuGet/Home/issues/4337 until AppVeyor gets
  # VS 15.6.
  - ps: $urlCurrent = "https://dotnetcli.blob.core.windows.net/dotnet/Sdk/master/dotnet-sdk-latest-win-x64.zip"
  - ps: $env:DOTNET_INSTALL_DIR = "$pwd\.dotnetsdk"
  - ps: mkdir $env:DOTNET_INSTALL_DIR -Force | Out-Null
  - ps: $tempFileCurrent = [System.IO.Path]::GetTempFileName()
  - ps: (New-Object System.Net.WebClient).DownloadFile($urlCurrent, $tempFileCurrent)
  - ps: Add-Type -AssemblyName System.IO.Compression.FileSystem; [System.IO.Compression.ZipFile]::ExtractToDirectory($tempFileCurrent, $env:DOTNET_INSTALL_DIR)
  - ps: $env:Path = "$env:DOTNET_INSTALL_DIR;$env:Path"
before_build:
  - dotnet restore
  - ps: gitversion /output buildserver
build:
  verbosity: minimal
after_build:
  - dotnet msbuild /t:Restore,Pack /p:PackageOutputPath=artifacts
artifacts:
  - path: "**\\artifacts\\**\\*.*"